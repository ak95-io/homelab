---
all:
  hosts:
    nas.dc0.ak95.io:
      ansible_user: aam
      users_to_setup:
        aam:
          skip_create: true
          ssh:
            authorized_keys:
              - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINCPCeqDxLSZz/1BVTQu62dU+D+mowjZc3aNE1HGbnUo aamkye@github.com
          sudoers: |
            aam ALL=(ALL) NOPASSWD:ALL
        operations:
          uid: 2000
          gid: 2000
          ssh:
            authorized_keys:
              - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINCPCeqDxLSZz/1BVTQu62dU+D+mowjZc3aNE1HGbnUo aamkye@github.com
            keys:
              - name: ssh.ecdsa.operations
                private: !vault |
                  $ANSIBLE_VAULT;1.2;AES256;id-08-10-23
                  35313433623566643339336434646432663734353833353862653239383134333164376564366461
                  3936653363613462356333386534663234353333336165610a633337346163646230633861656662
                  63623437333431393730383534323836646233373731376261313363313261636233393863316165
                  6362373361663837360a316361323362613835363039376365393033363031366262663839653335
                  62393866316466373039643837663235383565323166393835333734323565303136303961613632
                  39653135353466366336396336383633626566666166396566646532393366356538623365616261
                  32363139333731663461373964313932386362386530333165306165333563663437316663303665
                  65386438333631323266386534343137336163306166343863666561393630366530313135313135
                  31656166386461653630343433616633366664373561376236633733376238313661383066353166
                  61373764633466653539613431623330383864656430353263363638653533666439333364323836
                  34616462383636643934653666393532623931663930616232356230346139616139646136613732
                  36316533373136626238393230626365373163623265333563376661336330323036323566346236
                  35626231383762383663303739653761343537623463356435353638343132356461323265306537
                  64356539623333303431373435336461363633303261326535333432663230363238353831366335
                  36343164663339386331303434366164353962626435323634303561616332376133383563393934
                  33376332333737383566326431363233323934613030636266313335306564376533633564316337
                  31363738636562303862646636356335306566323230323736643833333066303665643935626236
                  38633561343830636138363565333835646230336566343539373862663663623038643431353966
                  35663035663738663737643039646462316334383761376332613735666231363466366461393563
                  31393562336639613732336532366163663762316238663235323930393838623064663938303061
                  66326166326332306132303730623265653239323635383936333133363132316339356238663932
                  30306130373937643665363366343066303561346638373735353563323133316466333031646463
                  31623731313761616130326332333833616632623732663461303537636263656333393733636266
                  36623263616435346334393264383031396362383438373436623430653039366334653938373964
                  66376632333534303435373132613237653830613232626561303730663635313936636139383766
                  37373266366463376432383736313162363063316338346533363231316163613562616333343335
                  63323230623266363535316366363663653139636134373030616630393933333364663261663833
                  31303165383834366134343965623330366335623937336439396436326233643063623565373164
                  39636135636166386430316536393962643132313232336565616464663566656438306134373563
                  3238373434616362326466363661643734326361346435306161
                public: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJjM2pS6OKJALsqu7ES5h7TfjM5ZLm6ovBIg2c9ictp7 operations
            config_addons:
              - |
                Host backup backup.dc0.ak95.io
                  User operations
                  IdentityFile ~/.ssh/ssh.ecdsa.operations.priv
                  IdentitiesOnly yes
          crontab: |
            0 1 * * * /home/operations/.bin/syncoid.backup.sh
            0 0 * * * /home/operations/.bin/partition.backup.sh
          scripts:
            - syncoid.backup.sh
            - partition.backup.sh
          sudoers: |
            # Send snapshots to backup
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zpool get -o value -H feature@extensible_dataset system
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs list -o name\,origin -t filesystem\,volume -Hr system/vm/hass
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H syncoid\:sync system/vm/hass
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t snapshot guid\,creation system/vm/hass
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send -nvP system/vm/hass@autosnap_*
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send system/vm/hass@autosnap_*
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t bookmark guid\,creation system/vm/hass
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send -I system/vm/hass@autosnap* system/vm/hass@autosnap_*
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send -nvP -I system/vm/hass@autosnap_* system/vm/hass@autosnap_*
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zpool get -o value -H feature@extensible_dataset *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs list -o name\,origin -t filesystem\,volume -Hr *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H syncoid\:sync *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t snapshot guid\,creation *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send -nvP *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t bookmark guid\,creation *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send -I *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs send -nvP -I *
    backup.dc0.ak95.io:
      ansible_user: aam
      users_to_setup:
        aam:
          skip_create: true
          ssh:
            authorized_keys:
              - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINCPCeqDxLSZz/1BVTQu62dU+D+mowjZc3aNE1HGbnUo aamkye@github.com
          sudoers: |
            aam ALL=(ALL) NOPASSWD:ALL
        operations:
          uid: 2000
          gid: 2000
          ssh:
            authorized_keys:
              - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINCPCeqDxLSZz/1BVTQu62dU+D+mowjZc3aNE1HGbnUo aamkye@github.com
              - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJjM2pS6OKJALsqu7ES5h7TfjM5ZLm6ovBIg2c9ictp7 operations
          crontab: |
            0 0 * * * /home/operations/.bin/partition.backup.sh
          scripts:
            - partition.backup.sh
          sudoers: |
            # Receive snapshots from nas
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zpool get -o value -H feature@extensible_dataset system
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H name system/backups-by-snapshot/syncoid/homeassistant
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs receive -F system/backups-by-snapshot/syncoid
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs receive -s -F system/backups-by-snapshot/syncoid/homeassistant
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H receive_resume_token system/backups-by-snapshot/syncoid
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t snapshot guid\,creation system/backups-by-snapshot/syncoid
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H -p used system/backups-by-snapshot/syncoid
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H receive_resume_token system/backups-by-snapshot/syncoid/homeassistant
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t snapshot guid\,creation system/backups-by-snapshot/syncoid/homeassistant
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 type\,guid\,creation system/backups-by-snapshot/syncoid/homeassistant
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H -p used system/backups-by-snapshot/syncoid/homeassistant
            # operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs rollback -R system/backups-by-snapshot/syncoid/homeassistant@autosnap_*
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zpool get -o value -H feature@extensible_dataset *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H name *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs receive -F *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs receive -s -F *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H receive_resume_token *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t snapshot guid\,creation *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H -p used *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H receive_resume_token *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 -t snapshot guid\,creation *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -Hpd 1 type\,guid\,creation *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs get -H -p used *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs rollback -R *
            operations ALL=(ALL) NOPASSWD:/usr/sbin/zfs destroy *

    weather-station-00.dc0.ak95.io:
      ansible_user: aam
    weather-station-01.dc0.ak95.io:
      ansible_user: aam

managable:
  hosts:
    nas.dc0.ak95.io:
    backup.dc0.ak95.io:
